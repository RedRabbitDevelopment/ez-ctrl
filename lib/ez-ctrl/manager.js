// Generated by CoffeeScript 1.6.3
(function() {
  var ControllerManager, Q, fs, _;

  _ = require('underscore');

  Q = require('q');

  fs = require('fs');

  module.exports = ControllerManager = (function() {
    function ControllerManager() {
      this.controllers = [];
    }

    ControllerManager.prototype.getAllRoutes = function() {
      return _.reduce(this.controllers, function(memo, controller) {
        if (controller.modelName) {
          memo[controller.modelName] = controller.getRoutes();
        }
        return memo;
      }, {});
    };

    ControllerManager.prototype.readdir = function(dirname) {
      var _this = this;
      return Q.nfcall(fs.readdir, dirname).then(function(files) {
        _this.loadFiles(files, '.js');
        if (_this.controllers.length === 0) {
          return _this.loadFiles(dirname, files, '.coffee');
        }
      });
    };

    ControllerManager.prototype.loadFiles = function(dirname, files, ext) {
      var Controller, file, index, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = files.length; _i < _len; _i++) {
        file = files[_i];
        if (-1 !== (index = file.indexOf(ext))) {
          file = file.substr(0, index);
          Controller = require(dirname + "/" + file);
          if (Controller.isController && !Controller.isAbstract) {
            _results.push(this.addController(Controller));
          } else {
            _results.push(void 0);
          }
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    ControllerManager.prototype.registerRoutes = function(app) {
      var controller, _i, _len, _ref, _results;
      _ref = this.controllers;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        controller = _ref[_i];
        _results.push(controller.registerRoutes(app));
      }
      return _results;
    };

    ControllerManager.prototype.addController = function(ctrl) {
      return this.controllers.push(ctrl);
    };

    return ControllerManager;

  })();

}).call(this);
